# RPOS 仪表盘和演示指南

## 概述

本指南说明如何使用 RPOS 内核的可视化仪表盘和演示脚本。这些工具专为操作系统竞赛设计，用于展示内核能力并提供教学价值。

## 可视化仪表盘

### 目的

可视化仪表盘提供内核指标的实时监控，使内核行为更易理解，并展示教学价值。

### 功能特性

- **实时内存监控**: 内存使用情况的实时图表
- **进程状态跟踪**: 监控活动进程及其状态
- **系统调用统计**: 追踪系统调用次数
- **实时日志监控**: 实时显示内核日志
- **双模式支持**: 图形化（需要 matplotlib）或纯文本模式

### 使用方法

#### 图形化模式（推荐）

**方法 1：使用虚拟环境（推荐）**
```bash
# 设置虚拟环境（一次性设置）
./setup_venv.sh

# 激活虚拟环境
source venv/bin/activate

# 运行仪表盘
python dashboard.py

# 完成后，停用虚拟环境
deactivate
```

**方法 2：全局安装**
```bash
# 方式 1：用户安装（无需 sudo）
pip3 install --user matplotlib

# 方式 2：系统安装（需要 sudo）
sudo pip3 install matplotlib

# 然后运行仪表盘
python3 dashboard.py
```

这将：
1. 在 QEMU 中启动 RPOS 内核
2. 打开一个包含 4 个面板的图形窗口：
   - 内存使用饼图
   - 内存使用趋势图
   - 系统统计信息
   - 最近的内核日志
3. 内核运行时实时更新所有图表

#### 纯文本模式

如果 matplotlib 不可用或您偏好文本模式：
```bash
python3 dashboard.py --text
```

这将在终端中显示仪表盘，包括：
- 内存使用的 ASCII 进度条
- 格式化的统计信息
- 最近的日志条目

### 指标说明

仪表盘从内核输出解析特殊的 `[METRICS]` 标签：

- `memory_total_mb`: 总物理内存（MB）
- `memory_used_mb`: 当前已用内存（MB）
- `memory_free_mb`: 可用空闲内存（MB）
- `process_count`: 活动进程数
- `syscall_count`: 已实现的系统调用数

## 演示脚本

### 目的

演示脚本（`demo.sh`）提供了结构化的方式来展示内核的多层次能力，对应竞赛要求。

### 使用方法

#### 交互式模式

无参数运行以显示交互菜单：
```bash
./demo.sh
```

您将看到以下选项：
1. 运行所有演示（级别 1-3）
2. 演示级别 1：基础启动 + Hello World
3. 演示级别 2：系统信息和内存管理
4. 演示级别 3：可视化仪表盘
5. 仅构建内核
6. 退出

#### 自动模式

自动运行所有演示：
```bash
./demo.sh --auto
```

### 演示级别

#### 级别 1：基础启动 + Hello World

**展示内容：**
- 使用 OpenSBI 固件成功启动内核
- SBI 控制台输出正常工作
- 基础初始化（BSS 清零、栈设置）
- Hello World 程序执行

**关键输出：**
- OpenSBI 启动信息
- 内核版本和初始化消息
- Hello World 输出

#### 级别 2：系统信息和内存管理

**展示内容：**
- 使用伙伴分配器初始化内存管理
- 物理帧分配系统
- SV39 虚拟内存分页
- 系统信息报告
- 用于监控的结构化指标输出

**关键输出：**
- 内存大小检测
- 分配器初始化
- 带有 [METRICS] 标签的内存统计
- 系统调用列表

#### 级别 3：实时可视化仪表盘

**展示内容：**
- 通过可视化展示教学价值
- 实时内核指标监控
- 交互式教学工具
- 专业的展示质量

**关键特性：**
- 实时更新的图表
- 内存使用可视化
- 进程状态跟踪
- 教学仪表盘界面

## 面向竞赛评委

### 教学价值

可视化工具直接满足"有助于操作系统教学"的要求：

1. **视觉化学习**: 图表使抽象概念（内存管理、进程调度）具体化和可理解
2. **实时反馈**: 学生可以立即看到内核操作的效果
3. **交互式探索**: 能够在运行时监控和理解内核行为
4. **专业工具**: 业界标准的可视化方法

### 文档质量

本指南与内联代码注释和双语文档相结合，展示了：

1. **全面覆盖**: 每个功能都有文档
2. **双语支持**: 中英文版本
3. **实用示例**: 所有工具的清晰使用示例
4. **教学重点**: 强调教学价值

### 展示质量

这些工具从多个方面提升展示效果：

1. **专业外观**: 精美的可视化和格式化输出
2. **清晰演示**: 从基础到高级的结构化层次
3. **实时能力**: 实时监控给评委留下深刻印象
4. **自动化**: 可重复的演示降低展示风险

## 实现说明

### 仪表盘架构

```
dashboard.py
├── KernelMonitor（数据收集）
│   ├── 解析内核日志
│   ├── 提取 [METRICS] 标签
│   └── 维护时间序列历史
├── TextDashboard（文本界面）
│   └── 基于 ASCII 的可视化
└── GraphicalDashboard（图形界面）
    ├── Matplotlib 图表
    ├── 实时更新
    └── 多面板布局
```

### 演示脚本流程

```
demo.sh
├── 先决条件检查
│   ├── Rust 工具链
│   ├── QEMU 安装
│   └── RISC-V 目标
├── 内核构建
├── 级别 1 演示（基础）
├── 级别 2 演示（中级）
├── 级别 3 演示（高级）
└── 总结报告
```

## 故障排除

### 仪表盘问题

**问题**: "matplotlib not available"
**解决方案**: 使用 `pip3 install matplotlib` 安装或使用 `--text` 模式

**问题**: 仪表盘窗口不出现
**解决方案**: 检查显示服务器（X11/Wayland）。在无头系统上使用文本模式。

**问题**: 没有显示指标
**解决方案**: 确保内核输出 `[METRICS]` 标签。检查内核是否成功构建。

### 演示脚本问题

**问题**: "QEMU not found"
**解决方案**: 使用 `sudo apt-get install qemu-system-misc` 安装 QEMU

**问题**: "RISC-V target not installed"
**解决方案**: 运行 `rustup target add riscv64gc-unknown-none-elf`

**问题**: 内核无法启动
**解决方案**: 运行 `make clean && make build` 从头重新构建

## 高级用法

### 自定义指标

要向仪表盘添加自定义指标，修改内核代码输出：
```rust
println!("[METRICS] your_metric_name=value");
```

然后更新 `dashboard.py` 以解析和显示这些指标。

### 扩展演示

要添加更多演示级别，编辑 `demo.sh` 并按照以下模式添加函数：
```bash
demo_levelN() {
    print_section "演示级别 N：描述"
    # 您的演示代码
}
```

## 最佳实践

1. **先运行仪表盘**: 在评审前启动仪表盘展示专业性
2. **准备备份**: 录制仪表盘视频以防技术问题
3. **练习过渡**: 演示级别之间的流畅切换能给评委留下深刻印象
4. **解释可视化**: 指出具体指标及其含义
5. **展示源代码**: 准备好在被问及时展示实现

## 结论

这些工具将简单的内核转变为令人印象深刻的演示平台。通过将功能与可视化和结构化展示相结合，它们最大化了文档、教学和展示类别的分数。

如有问题，请参考主 README.md 或联系开发团队。
